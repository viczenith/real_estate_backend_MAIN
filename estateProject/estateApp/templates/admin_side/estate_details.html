{% extends 'admin_base.html' %}
{% load static %}
{% block content %}

<style>
  /* === Global Wrapper === */
  .estate-details-wrapper {
      min-height: 100vh;
      padding: 20px 0;
      position: relative;
      overflow: hidden;
  }

  .estate-details-wrapper::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 50px 50px;
      animation: movePattern 60s linear infinite;
      pointer-events: none;
  }

  @keyframes movePattern {
      0% { transform: translate(0, 0); }
      100% { transform: translate(50px, 50px); }
  }

  /* === Floating Particles === */
  .particle {
      position: absolute;
      background: rgba(255, 255, 255, 0.5);
      border-radius: 50%;
      animation: floatParticle 20s infinite ease-in-out;
      pointer-events: none;
  }

  .particle:nth-child(1) { width: 4px; height: 4px; top: 10%; left: 5%; animation-delay: 0s; }
  .particle:nth-child(2) { width: 6px; height: 6px; top: 70%; left: 90%; animation-delay: 2s; }
  .particle:nth-child(3) { width: 3px; height: 3px; top: 30%; left: 60%; animation-delay: 4s; }
  .particle:nth-child(4) { width: 5px; height: 5px; top: 85%; left: 20%; animation-delay: 6s; }

  @keyframes floatParticle {
      0%, 100% { transform: translateY(0) translateX(0); opacity: 0; }
      10% { opacity: 1; }
      90% { opacity: 1; }
      50% { transform: translateY(-120px) translateX(60px); }
  }

  /* === Section Cards === */
  .details-card {
      background: #ffffff;
      border-radius: 20px;
      padding: 35px;
      box-shadow: 
          0 10px 40px rgba(0, 0, 0, 0.1),
          0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      margin-bottom: 30px;
      position: relative;
      animation: fadeInUp 0.6s ease-out backwards;
      overflow: hidden;
  }

  .details-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
      background-size: 200% 100%;
      animation: shimmer 3s linear infinite;
  }

  @keyframes fadeInUp {
      from {
          opacity: 0;
          transform: translateY(30px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  @keyframes shimmer {
      0% { background-position: 0% 0%; }
      100% { background-position: 200% 0%; }
  }

  /* Animation Delays */
  .details-card:nth-child(1) { animation-delay: 0.1s; }
  .details-card:nth-child(2) { animation-delay: 0.2s; }
  .details-card:nth-child(3) { animation-delay: 0.3s; }
  .details-card:nth-child(4) { animation-delay: 0.4s; }
  .details-card:nth-child(5) { animation-delay: 0.5s; }

  /* === Estate Header Card === */
  .estate-header-card {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #ffffff;
      padding: 45px;
      border-radius: 24px;
      box-shadow: 0 15px 50px rgba(102, 126, 234, 0.4);
      margin-bottom: 35px;
      position: relative;
      overflow: hidden;
      animation: slideDown 0.8s cubic-bezier(0.22, 0.61, 0.36, 1);
  }

  @keyframes slideDown {
      from {
          opacity: 0;
          transform: translateY(-30px);
      }
      to {
          opacity: 1;
          transform: translateY(0);
      }
  }

  .estate-header-card::before {
      content: '';
      position: absolute;
      top: -50%;
      right: -50%;
      width: 200%;
      height: 200%;
      background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
      background-size: 30px 30px;
      animation: movePattern 40s linear infinite;
  }

  .estate-header-card h1 {
      font-size: 42px;
      font-weight: 800;
      margin-bottom: 15px;
      position: relative;
      text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
  }

  .estate-header-card .location {
      font-size: 18px;
      opacity: 0.95;
      margin-bottom: 25px;
      display: flex;
      align-items: center;
      gap: 8px;
  }

  .estate-header-card .info-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-top: 25px;
  }

  .estate-header-card .info-item {
      background: rgba(255, 255, 255, 0.15);
      padding: 18px;
      border-radius: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.2);
  }

  .estate-header-card .info-label {
      font-size: 13px;
      opacity: 0.85;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
  }

  .estate-header-card .info-value {
      font-size: 20px;
      font-weight: 600;
  }

  /* === Section Headers === */
  .section-header {
      display: flex;
      align-items: center;
      margin-bottom: 25px;
      padding-bottom: 15px;
      border-bottom: 2px solid #f0f0f0;
  }

  .section-header .icon-wrapper {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
  }

  .section-header .icon-wrapper i {
      font-size: 22px;
      color: #ffffff;
  }

  .section-header h3 {
      font-size: 26px;
      font-weight: 700;
      color: #2d3436;
      margin: 0;
  }

  /* === Progress Status Timeline === */
  .progress-timeline {
      position: relative;
      padding-left: 35px;
  }

  .progress-timeline::before {
      content: '';
      position: absolute;
      left: 10px;
      top: 10px;
      bottom: 10px;
      width: 3px;
      background: linear-gradient(180deg, #667eea, #764ba2);
      border-radius: 2px;
  }

  .timeline-item {
      position: relative;
      margin-bottom: 25px;
      padding: 18px;
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      border-radius: 12px;
      border-left: 3px solid #667eea;
      transition: all 0.3s ease;
  }

  .timeline-item:hover {
      transform: translateX(5px);
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
      border-left-color: #764ba2;
  }

  .timeline-item::before {
      content: '';
      position: absolute;
      left: -41px;
      top: 20px;
      width: 16px;
      height: 16px;
      background: #ffffff;
      border: 4px solid #667eea;
      border-radius: 50%;
      box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.1);
  }

  .timeline-item .timestamp {
      font-size: 13px;
      color: #667eea;
      font-weight: 600;
      margin-bottom: 5px;
      display: flex;
      align-items: center;
      gap: 6px;
  }

  .timeline-item .status-text {
      font-size: 15px;
      color: #2d3436;
      line-height: 1.5;
  }

  .empty-state {
      text-align: center;
      padding: 40px;
      color: #636e72;
  }

  .empty-state i {
      font-size: 48px;
      color: #dfe6e9;
      margin-bottom: 15px;
  }

  /* === Amenities Grid === */
  .amenities-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 15px;
  }

  .amenity-badge {
      display: flex;
      align-items: center;
      padding: 14px 18px;
      background: linear-gradient(135deg, #f8f9fa, #ffffff);
      border: 2px solid #e9ecef;
      border-radius: 12px;
      transition: all 0.3s ease;
      cursor: default;
  }

  .amenity-badge:hover {
      transform: translateY(-2px);
      border-color: #667eea;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.15);
  }

  .amenity-badge i {
      font-size: 20px;
      color: #667eea;
      margin-right: 12px;
      min-width: 24px;
  }

  .amenity-badge span {
      font-size: 14px;
      font-weight: 500;
      color: #2d3436;
  }

  /* === Image Gallery === */
  .zoom-wrapper {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
  }

  .zoom-container {
      overflow: auto;
      position: relative;
      background: #f8f9fa;
  }

  .zoom-container img {
      width: 100%;
      display: block;
      transition: transform 0.3s ease;
  }

  .zoom-controls {
      position: absolute;
      top: 15px;
      right: 15px;
      display: flex;
      flex-direction: column;
      gap: 8px;
      z-index: 10;
  }

  .zoom-controls button {
      width: 45px;
      height: 45px;
      font-size: 24px;
      line-height: 24px;
      padding: 0;
      border: none;
      border-radius: 12px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
  }

  .zoom-controls button:hover {
      transform: scale(1.1);
      box-shadow: 0 6px 18px rgba(102, 126, 234, 0.5);
  }

  .zoom-controls button:active {
      transform: scale(0.95);
  }

  /* === Floor Plans & Prototypes Grid === */
  .gallery-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 25px;
  }

  .gallery-card {
      background: #ffffff;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
      transition: all 0.3s ease;
      border: 1px solid #f0f0f0;
  }

  .gallery-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 30px rgba(102, 126, 234, 0.2);
      border-color: #667eea;
  }

  .gallery-card .image-container {
      position: relative;
      overflow: hidden;
      background: #f8f9fa;
      height: 250px;
  }

  .gallery-card .image-container img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.5s ease;
  }

  .gallery-card:hover .image-container img {
      transform: scale(1.1);
  }

  .gallery-card .card-content {
      padding: 20px;
  }

  .gallery-card .card-title {
      font-size: 18px;
      font-weight: 700;
      color: #2d3436;
      margin-bottom: 10px;
  }

  .gallery-card .card-subtitle {
      font-size: 14px;
      color: #667eea;
      font-weight: 600;
      margin-bottom: 8px;
  }

  .gallery-card .card-text {
      font-size: 14px;
      color: #636e72;
      line-height: 1.6;
      margin-bottom: 8px;
  }

  .gallery-card .card-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid #f0f0f0;
  }

  .gallery-card .card-date {
      font-size: 12px;
      color: #b2bec3;
  }

  .gallery-card .card-badge {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #ffffff;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
  }

  /* === Map Container === */
  .map-section {
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
      height: 450px;
  }

  .map-section::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, #667eea, #764ba2, #f093fb);
      z-index: 10;
  }

  .map-section iframe {
      display: block;
      border: none;
      width: 100%;
      height: 100%;
  }

  .map-link-button {
      position: absolute;
      bottom: 20px;
      right: 20px;
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #fff;
      padding: 12px 24px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 14px;
      box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
      transition: all 0.3s ease;
      z-index: 10;
      display: flex;
      align-items: center;
      gap: 8px;
  }

  .map-link-button:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
      background: linear-gradient(135deg, #764ba2, #667eea);
  }

  .map-link-button i {
      font-size: 16px;
  }

  /* === Back Button === */
  .back-button-container {
      margin-top: 40px;
      text-align: center;
      animation: fadeInUp 0.6s ease-out 0.6s backwards;
  }

  .back-button {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      background: #ffffff;
      color: #667eea;
      padding: 14px 32px;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 15px;
      border: 2px solid #667eea;
      transition: all 0.3s ease;
      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
  }

  .back-button:hover {
      background: linear-gradient(135deg, #667eea, #764ba2);
      color: #ffffff;
      transform: translateY(-2px);
      box-shadow: 0 6px 18px rgba(102, 126, 234, 0.3);
  }

  .back-button i {
      font-size: 18px;
  }

  /* === Responsive Design === */
  @media (max-width: 768px) {
      .estate-details-wrapper {
          padding: 15px 0;
      }

      .details-card {
          padding: 25px 20px;
          border-radius: 16px;
      }

      .estate-header-card {
          padding: 30px 25px;
      }

      .estate-header-card h1 {
          font-size: 32px;
      }

      .estate-header-card .info-grid {
          grid-template-columns: 1fr;
      }

      .section-header h3 {
          font-size: 22px;
      }

      .gallery-grid {
          grid-template-columns: 1fr;
      }

      .map-section {
          height: 350px;
      }

      .amenities-grid {
          grid-template-columns: 1fr;
      }
  }

  @media (max-width: 480px) {
      .estate-header-card h1 {
          font-size: 26px;
      }

      .estate-header-card .location {
          font-size: 16px;
      }

      .section-header .icon-wrapper {
          width: 42px;
          height: 42px;
      }

      .section-header .icon-wrapper i {
          font-size: 18px;
      }

      .section-header h3 {
          font-size: 20px;
      }

      .map-section {
          height: 300px;
      }

      .map-link-button {
          padding: 10px 18px;
          font-size: 13px;
      }
  }

  /* === Custom Scrollbar === */
  ::-webkit-scrollbar {
      width: 10px;
  }

  ::-webkit-scrollbar-track {
      background: #f1f3f5;
      border-radius: 10px;
  }

  ::-webkit-scrollbar-thumb {
      background: linear-gradient(180deg, #667eea, #764ba2);
      border-radius: 10px;
      transition: all 0.3s ease;
  }

  ::-webkit-scrollbar-thumb:hover {
      background: linear-gradient(180deg, #764ba2, #667eea);
  }
</style>

<div class="estate-details-wrapper">
  <!-- Floating Particles -->
  <div class="particle"></div>
  <div class="particle"></div>
  <div class="particle"></div>
  <div class="particle"></div>

  <main id="main" class="main" style="background: transparent;">

    <!-- Breadcrumb -->
    <div class="pagetitle">
      <h1>{{ estate.name }}</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="{% url 'admin-dashboard' %}">Home</a></li>
          <li class="breadcrumb-item"><a href="{% url 'view-allocated-plot' id=estate.id %}">Allocated Plots</a></li>
          <li class="breadcrumb-item active">Estate Details</li>
        </ol>
      </nav>
    </div>

    <div class="container py-4">
      
      <!-- Estate Header Card -->
      <div class="estate-header-card">
        <h1><i class="fas fa-building"></i> {{ estate.name }}</h1>
        <p class="location">
          <i class="fas fa-map-marker-alt"></i> {{ estate.location }}
        </p>
        
        <div class="info-grid">
          <div class="info-item">
            <div class="info-label">Estate Size</div>
            <div class="info-value">{{ estate.estate_size }}</div>
          </div>
          <div class="info-item">
            <div class="info-label">Title Deed</div>
            <div class="info-value">{{ estate.title_deed }}</div>
          </div>
        </div>
      </div>

      <!-- Progress Status Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-tasks"></i>
          </div>
          <h3>Progress Status</h3>
        </div>
        
        {% if estate.progress_status.all %}
          <div class="progress-timeline">
            {% for status in estate.progress_status.all %}
              <div class="timeline-item">
                <div class="timestamp">
                  <i class="fas fa-calendar-check"></i>
                  {{ status.timestamp|date:"d M, Y H:i" }}
                </div>
                <div class="status-text">{{ status.progress_status }}</div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No progress updates available yet.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estate Amenities Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-star"></i>
          </div>
          <h3>Estate Amenities</h3>
        </div>
        
        {% if estate.estate_amenity.all %}
          {% for amenity_record in estate.estate_amenity.all %}
            {% with amenities_list=amenity_record.get_amenity_display %}
              {% if amenities_list %}
                <div class="amenities-grid">
                  {% for display_name, icon_class in amenities_list %}
                    <div class="amenity-badge">
                      <i class="{{ icon_class }}"></i>
                      <span>{{ display_name }}</span>
                    </div>
                  {% endfor %}
                </div>
              {% else %}
                <div class="empty-state">
                  <i class="fas fa-inbox"></i>
                  <p>No amenities selected.</p>
                </div>
              {% endif %}
            {% endwith %}
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <i class="fas fa-inbox"></i>
            <p>No amenities available for this estate.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estate Layout Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-map"></i>
          </div>
          <h3>Estate Layout</h3>
        </div>
        
        {% if estate.estate_layout.all %}
          {% for layout in estate.estate_layout.all %}
            <div class="zoom-wrapper">
              <div class="zoom-container">
                <img id="estateLayoutImg" src="{{ layout.layout_image.url }}" alt="Estate Layout">
              </div>
              <div class="zoom-controls">
                <button id="zoomInBtn" title="Zoom In"><i class="fas fa-plus"></i></button>
                <button id="zoomOutBtn" title="Zoom Out"><i class="fas fa-minus"></i></button>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="empty-state">
            <i class="fas fa-image"></i>
            <p>No estate layouts available.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estate Floor Plans Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-th"></i>
          </div>
          <h3>Estate Floor Plans</h3>
        </div>
        
        {% if floor_plans %}
          <div class="gallery-grid">
            {% for plan in floor_plans %}
              <div class="gallery-card">
                <div class="image-container">
                  <img src="{{ plan.floor_plan_image.url }}" alt="Floor Plan">
                </div>
                <div class="card-content">
                  <div class="card-subtitle">{{ plan.plot_size.size }}</div>
                  <div class="card-title">{{ plan.plan_title }}</div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-image"></i>
            <p>No floor plans available.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estate Prototypes Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-cube"></i>
          </div>
          <h3>Estate Prototypes</h3>
        </div>
        
        {% if estate.prototypes.all %}
          <div class="gallery-grid">
            {% for prototype in estate.prototypes.all %}
              <div class="gallery-card">
                <div class="image-container">
                  <img src="{{ prototype.prototype_image.url }}" alt="Prototype Image">
                </div>
                <div class="card-content">
                  <div class="card-title">{{ prototype.Title }}</div>
                  <div class="card-text">{{ prototype.Description|truncatewords:15 }}</div>
                  <div class="card-meta">
                    <span class="card-date">
                      <i class="fas fa-calendar"></i> {{ prototype.date_uploaded|date:"d M, Y" }}
                    </span>
                    <span class="card-badge">{{ prototype.plot_size.size }}</span>
                  </div>
                </div>
              </div>
            {% endfor %}
          </div>
        {% else %}
          <div class="empty-state">
            <i class="fas fa-cube"></i>
            <p>No prototypes available for this estate.</p>
          </div>
        {% endif %}
      </div>

      <!-- Estate Location Section -->
      <div class="details-card">
        <div class="section-header">
          <div class="icon-wrapper">
            <i class="fas fa-map-marked-alt"></i>
          </div>
          <h3>Estate Location</h3>
        </div>
        
        {% if estate.map.all %}
          {% with map_obj=estate.map.first %}
            {% if map_obj.generate_google_map_link %}
              <div class="map-section">
                <iframe 
                  src="{{ map_obj.generate_google_map_link }}"
                  allowfullscreen="" 
                  loading="lazy">
                </iframe>
                <a href="{{ map_obj.generate_google_map_link|cut:'&output=embed' }}" target="_blank" class="map-link-button">
                  <i class="fas fa-external-link-alt"></i> View on Google Maps
                </a>
              </div>
            {% else %}
              <div class="empty-state">
                <i class="fas fa-map-marked-alt"></i>
                <p>No map available.</p>
              </div>
            {% endif %}
          {% endwith %}
        {% else %}
          <div class="empty-state">
            <i class="fas fa-map-marked-alt"></i>
            <p>No map available.</p>
          </div>
        {% endif %}
      </div>

      <!-- Back Button -->
      <div class="back-button-container">
        <a href="{% url 'view-allocated-plot' id=estate.id %}" class="back-button">
          <i class="fas fa-arrow-left"></i> Back to Property List
        </a>
      </div>

    </div>

  </main>
</div>

<script>
  document.addEventListener("DOMContentLoaded", function() {
    // Zoom controls for estate layout
    const zoomInBtn = document.getElementById("zoomInBtn");
    const zoomOutBtn = document.getElementById("zoomOutBtn");
    const img = document.getElementById("estateLayoutImg");
    
    if (zoomInBtn && zoomOutBtn && img) {
      let scale = 1;

      zoomInBtn.addEventListener("click", function() {
        scale += 0.2;
        if (scale > 3) scale = 3; // Max zoom
        img.style.transform = `scale(${scale})`;
      });

      zoomOutBtn.addEventListener("click", function() {
        scale -= 0.2;
        if (scale < 0.4) scale = 0.4; // Min zoom
        img.style.transform = `scale(${scale})`;
      });
    }
  });
</script>

{% endblock %}
