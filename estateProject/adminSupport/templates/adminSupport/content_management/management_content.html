{% extends 'adminSupport/base.html' %}

{% block title %}Content Management{% endblock %}

{% block content %}
<div class="content-header">
    <div>
        <h1>Content Management</h1>
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="{% url 'adminSupport:support_dashboard' %}">Dashboard</a></li>
                <li class="breadcrumb-item active">Content Management</li>
            </ol>
        </nav>
    </div>
    <div>
        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#addContentModal">
            <i class="fas fa-plus me-2"></i>Add Content
        </button>
    </div>
</div>

<!-- Content Overview -->
<div class="row mb-4">
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon bg-primary bg-opacity-10 text-primary">
                <i class="fas fa-file-alt"></i>
            </div>
            <h3 id="totalPages">12</h3>
            <p>Total Pages</p>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon bg-success bg-opacity-10 text-success">
                <i class="fas fa-images"></i>
            </div>
            <h3 id="totalMedia">45</h3>
            <p>Media Files</p>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon bg-warning bg-opacity-10 text-warning">
                <i class="fas fa-edit"></i>
            </div>
            <h3 id="pendingReviews">3</h3>
            <p>Pending Reviews</p>
        </div>
    </div>
    <div class="col-xl-3 col-md-6 mb-4">
        <div class="stats-card">
            <div class="stats-icon bg-info bg-opacity-10 text-info">
                <i class="fas fa-clock"></i>
            </div>
            <h3 id="lastUpdate">2h ago</h3>
            <p>Last Update</p>
        </div>
    </div>
</div>

<!-- Content Management Tabs -->
<div class="card">
    <div class="card-header">
        <ul class="nav nav-tabs card-header-tabs" id="contentTabs" role="tablist">
            <li class="nav-item" role="presentation">
                <button class="nav-link active" id="pages-tab" data-bs-toggle="tab" data-bs-target="#pages" type="button" role="tab">
                    <i class="fas fa-file-alt me-2"></i>Pages
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="media-tab" data-bs-toggle="tab" data-bs-target="#media" type="button" role="tab">
                    <i class="fas fa-images me-2"></i>Media Library
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="navigation-tab" data-bs-toggle="tab" data-bs-target="#navigation" type="button" role="tab">
                    <i class="fas fa-sitemap me-2"></i>Navigation
                </button>
            </li>
            <li class="nav-item" role="presentation">
                <button class="nav-link" id="settings-tab" data-bs-toggle="tab" data-bs-target="#settings" type="button" role="tab">
                    <i class="fas fa-cog me-2"></i>Settings
                </button>
            </li>
        </ul>
    </div>
    <div class="card-body">
        <div class="tab-content" id="contentTabsContent">
            <!-- Pages Tab -->
            <div class="tab-pane fade show active" id="pages" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="input-group" style="max-width: 300px;">
                        <input type="text" class="form-control" id="pageSearch" placeholder="Search pages...">
                        <button class="btn btn-outline-secondary" onclick="searchPages()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="loadPages()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                        <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addPageModal">
                            <i class="fas fa-plus me-1"></i>New Page
                        </button>
                    </div>
                </div>
                
                <div id="pagesContainer">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading pages...</p>
                    </div>
                </div>
            </div>

            <!-- Media Library Tab -->
            <div class="tab-pane fade" id="media" role="tabpanel">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="d-flex align-items-center">
                        <div class="input-group me-3" style="max-width: 300px;">
                            <input type="text" class="form-control" id="mediaSearch" placeholder="Search media...">
                            <button class="btn btn-outline-secondary" onclick="searchMedia()">
                                <i class="fas fa-search"></i>
                            </button>
                        </div>
                        <select class="form-select" id="mediaFilter" style="max-width: 150px;" onchange="filterMedia()">
                            <option value="all">All Files</option>
                            <option value="images">Images</option>
                            <option value="documents">Documents</option>
                            <option value="videos">Videos</option>
                        </select>
                    </div>
                    <div>
                        <button class="btn btn-outline-primary btn-sm me-2" onclick="loadMedia()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                        <button class="btn btn-primary btn-sm" onclick="uploadMedia()">
                            <i class="fas fa-upload me-1"></i>Upload
                        </button>
                    </div>
                </div>
                
                <div id="mediaContainer">
                    <div class="text-center py-4">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-2">Loading media files...</p>
                    </div>
                </div>
            </div>

            <!-- Navigation Tab -->
            <div class="tab-pane fade" id="navigation" role="tabpanel">
                <div class="row">
                    <div class="col-md-6">
                        <h5>Main Navigation</h5>
                        <div id="mainNavigation" class="border rounded p-3 mb-3" style="min-height: 300px;">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading navigation...</p>
                            </div>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="addNavItem()">
                            <i class="fas fa-plus me-1"></i>Add Menu Item
                        </button>
                    </div>
                    <div class="col-md-6">
                        <h5>Footer Links</h5>
                        <div id="footerNavigation" class="border rounded p-3 mb-3" style="min-height: 300px;">
                            <div class="text-center py-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">Loading...</span>
                                </div>
                                <p class="mt-2">Loading footer links...</p>
                            </div>
                        </div>
                        <button class="btn btn-outline-primary btn-sm" onclick="addFooterLink()">
                            <i class="fas fa-plus me-1"></i>Add Footer Link
                        </button>
                    </div>
                </div>
            </div>

            <!-- Settings Tab -->
            <div class="tab-pane fade" id="settings" role="tabpanel">
                <form id="siteSettingsForm">
                    <div class="row">
                        <div class="col-md-6">
                            <h5 class="mb-3">General Settings</h5>
                            <div class="mb-3">
                                <label class="form-label">Site Title</label>
                                <input type="text" class="form-control" name="site_title" value="Real Estate Management System">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Site Description</label>
                                <textarea class="form-control" name="site_description" rows="3">Your premier real estate management platform</textarea>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Contact Email</label>
                                <input type="email" class="form-control" name="contact_email" value="contact@realestate.com">
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Contact Phone</label>
                                <input type="tel" class="form-control" name="contact_phone" value="+1-234-567-8900">
                            </div>
                        </div>
                        <div class="col-md-6">
                            <h5 class="mb-3">Display Settings</h5>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="maintenanceMode" name="maintenance_mode">
                                    <label class="form-check-label" for="maintenanceMode">
                                        Maintenance Mode
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <div class="form-check form-switch">
                                    <input class="form-check-input" type="checkbox" id="userRegistration" name="user_registration" checked>
                                    <label class="form-check-label" for="userRegistration">
                                        Allow User Registration
                                    </label>
                                </div>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Properties per Page</label>
                                <select class="form-select" name="properties_per_page">
                                    <option value="10">10</option>
                                    <option value="20" selected>20</option>
                                    <option value="50">50</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Theme</label>
                                <select class="form-select" name="theme">
                                    <option value="default" selected>Default</option>
                                    <option value="dark">Dark</option>
                                    <option value="blue">Blue</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <hr>
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Save Settings
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!-- Add Page Modal -->
<div class="modal fade" id="addPageModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Page</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <form id="addPageForm">
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Page Title</label>
                        <input type="text" class="form-control" name="title" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">URL Slug</label>
                        <input type="text" class="form-control" name="slug" required>
                        <div class="form-text">URL-friendly version of the title</div>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Page Content</label>
                        <textarea class="form-control" name="content" rows="10" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Status</label>
                            <select class="form-select" name="status">
                                <option value="draft">Draft</option>
                                <option value="published" selected>Published</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Template</label>
                            <select class="form-select" name="template">
                                <option value="default">Default</option>
                                <option value="full-width">Full Width</option>
                                <option value="landing">Landing Page</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save me-2"></i>Create Page
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Add Content Modal -->
<div class="modal fade" id="addContentModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add Content</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="row g-3">
                    <div class="col-6">
                        <button class="btn btn-outline-primary w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;" data-bs-dismiss="modal" data-bs-toggle="modal" data-bs-target="#addPageModal">
                            <i class="fas fa-file-alt fa-2x mb-2"></i>
                            <span>New Page</span>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-success w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;" onclick="uploadMedia(); $('#addContentModal').modal('hide');">
                            <i class="fas fa-upload fa-2x mb-2"></i>
                            <span>Upload Media</span>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-warning w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;" onclick="addNavItem(); $('#addContentModal').modal('hide');">
                            <i class="fas fa-sitemap fa-2x mb-2"></i>
                            <span>Menu Item</span>
                        </button>
                    </div>
                    <div class="col-6">
                        <button class="btn btn-outline-info w-100 h-100 d-flex flex-column align-items-center justify-content-center" style="min-height: 100px;" onclick="$('#settings-tab').click(); $('#addContentModal').modal('hide');">
                            <i class="fas fa-cog fa-2x mb-2"></i>
                            <span>Settings</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    loadPages();
    loadMedia();
    loadNavigation();
});

function loadPages() {
    $('#pagesContainer').html(`
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading pages...</p>
        </div>
    `);
    
    // Simulate loading pages
    setTimeout(function() {
        const samplePages = [
            { id: 1, title: "Home Page", slug: "home", status: "published", modified: "2025-01-09", views: 1250 },
            { id: 2, title: "About Us", slug: "about", status: "published", modified: "2025-01-08", views: 890 },
            { id: 3, title: "Properties", slug: "properties", status: "published", modified: "2025-01-07", views: 2150 },
            { id: 4, title: "Contact", slug: "contact", status: "published", modified: "2025-01-06", views: 560 },
            { id: 5, title: "Privacy Policy", slug: "privacy", status: "draft", modified: "2025-01-05", views: 45 }
        ];
        
        displayPages(samplePages);
    }, 1500);
}

function displayPages(pages) {
    let html = `
        <div class="table-responsive">
            <table class="table table-hover">
                <thead>
                    <tr>
                        <th>Title</th>
                        <th>Slug</th>
                        <th>Status</th>
                        <th>Modified</th>
                        <th>Views</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
    `;
    
    pages.forEach(function(page) {
        const statusBadge = page.status === 'published' ? 'bg-success' : 'bg-warning';
        
        html += `
            <tr>
                <td>
                    <strong>${page.title}</strong>
                </td>
                <td>
                    <code>/${page.slug}</code>
                </td>
                <td>
                    <span class="badge ${statusBadge}">${page.status}</span>
                </td>
                <td>${new Date(page.modified).toLocaleDateString()}</td>
                <td>${page.views.toLocaleString()}</td>
                <td>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary" onclick="editPage(${page.id})" title="Edit">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-outline-success" onclick="viewPage(${page.id})" title="View">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="btn btn-outline-danger" onclick="deletePage(${page.id})" title="Delete">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </td>
            </tr>
        `;
    });
    
    html += `
                </tbody>
            </table>
        </div>
    `;
    
    $('#pagesContainer').html(html);
}

function loadMedia() {
    $('#mediaContainer').html(`
        <div class="text-center py-4">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">Loading media files...</p>
        </div>
    `);
    
    // Simulate loading media
    setTimeout(function() {
        const sampleMedia = [
            { id: 1, name: "property-1.jpg", type: "image", size: "2.4 MB", uploaded: "2025-01-09" },
            { id: 2, name: "floor-plan.pdf", type: "document", size: "1.8 MB", uploaded: "2025-01-08" },
            { id: 3, name: "property-tour.mp4", type: "video", size: "15.2 MB", uploaded: "2025-01-07" },
            { id: 4, name: "logo.png", type: "image", size: "156 KB", uploaded: "2025-01-06" }
        ];
        
        displayMedia(sampleMedia);
    }, 1500);
}

function displayMedia(media) {
    let html = '<div class="row">';
    
    media.forEach(function(file) {
        const icon = file.type === 'image' ? 'fa-image' : file.type === 'video' ? 'fa-video' : 'fa-file-alt';
        const color = file.type === 'image' ? 'text-primary' : file.type === 'video' ? 'text-danger' : 'text-secondary';
        
        html += `
            <div class="col-md-3 col-sm-6 mb-4">
                <div class="card h-100">
                    <div class="card-body text-center">
                        <i class="fas ${icon} fa-3x ${color} mb-3"></i>
                        <h6 class="card-title text-truncate">${file.name}</h6>
                        <p class="card-text small text-muted">${file.size}<br>${new Date(file.uploaded).toLocaleDateString()}</p>
                    </div>
                    <div class="card-footer bg-transparent">
                        <div class="btn-group btn-group-sm w-100">
                            <button class="btn btn-outline-primary" onclick="viewMedia(${file.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                            <button class="btn btn-outline-success" onclick="copyMediaUrl(${file.id})">
                                <i class="fas fa-copy"></i>
                            </button>
                            <button class="btn btn-outline-danger" onclick="deleteMedia(${file.id})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    $('#mediaContainer').html(html);
}

function loadNavigation() {
    setTimeout(function() {
        const mainNav = `
            <div class="list-group">
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-home me-2"></i>Home
                    </div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-building me-2"></i>Properties
                    </div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-info-circle me-2"></i>About
                    </div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>
                        <i class="fas fa-envelope me-2"></i>Contact
                    </div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>
        `;
        
        const footerNav = `
            <div class="list-group">
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>Privacy Policy</div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>Terms of Service</div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
                <div class="list-group-item d-flex justify-content-between align-items-center">
                    <div>Support</div>
                    <div class="btn-group btn-group-sm">
                        <button class="btn btn-outline-primary"><i class="fas fa-edit"></i></button>
                        <button class="btn btn-outline-danger"><i class="fas fa-trash"></i></button>
                    </div>
                </div>
            </div>
        `;
        
        $('#mainNavigation').html(mainNav);
        $('#footerNavigation').html(footerNav);
    }, 1000);
}

// Page functions
function editPage(id) {
    alert(`Edit page ${id}`);
}

function viewPage(id) {
    alert(`View page ${id}`);
}

function deletePage(id) {
    if (confirm('Are you sure you want to delete this page?')) {
        alert(`Delete page ${id}`);
    }
}

function searchPages() {
    const query = $('#pageSearch').val();
    alert(`Search pages: ${query}`);
}

// Media functions
function viewMedia(id) {
    alert(`View media ${id}`);
}

function copyMediaUrl(id) {
    alert(`Copy URL for media ${id}`);
}

function deleteMedia(id) {
    if (confirm('Are you sure you want to delete this media file?')) {
        alert(`Delete media ${id}`);
    }
}

function uploadMedia() {
    alert('Upload media functionality coming soon!');
}

function searchMedia() {
    const query = $('#mediaSearch').val();
    alert(`Search media: ${query}`);
}

function filterMedia() {
    const filter = $('#mediaFilter').val();
    alert(`Filter media by: ${filter}`);
}

// Navigation functions
function addNavItem() {
    alert('Add navigation item functionality coming soon!');
}

function addFooterLink() {
    alert('Add footer link functionality coming soon!');
}

// Form submissions
$('#addPageForm').on('submit', function(e) {
    e.preventDefault();
    
    alert('Page created successfully!');
    $('#addPageModal').modal('hide');
    this.reset();
    loadPages();
});

$('#siteSettingsForm').on('submit', function(e) {
    e.preventDefault();
    
    alert('Settings saved successfully!');
});

// Auto-generate slug from title
$('#addPageForm input[name="title"]').on('input', function() {
    const title = $(this).val();
    const slug = title.toLowerCase().replace(/[^a-z0-9]+/g, '-').replace(/(^-|-$)/g, '');
    $('#addPageForm input[name="slug"]').val(slug);
});
</script>
{% endblock %}